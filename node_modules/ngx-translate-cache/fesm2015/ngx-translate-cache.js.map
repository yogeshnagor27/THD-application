{"version":3,"file":"ngx-translate-cache.js","sources":["ng://ngx-translate-cache/lib/ngx-translate-cache.service.ts","ng://ngx-translate-cache/lib/ngx-translate-cache.module.ts","ng://ngx-translate-cache/public-api.ts","ng://ngx-translate-cache/ngx-translate-cache.ts"],"sourcesContent":["import { Inject, Injectable, InjectionToken, Provider } from '@angular/core';\nimport { TranslateService, TranslationChangeEvent } from '@ngx-translate/core';\n\nexport type CacheMechanismType = 'LocalStorage' | 'Cookie';\nexport namespace CacheMechanism {\n  export const LocalStorage: CacheMechanismType = 'LocalStorage';\n  export const Cookie: CacheMechanismType = 'Cookie';\n}\n\nexport const CACHE_NAME = new InjectionToken<string>('CACHE_NAME');\nexport const CACHE_MECHANISM = new InjectionToken<string>('CACHE_MECHANISM');\nexport const COOKIE_EXPIRY = new InjectionToken<string>('COOKIE_EXPIRY');\n\nexport interface TranslateCacheConfig {\n  cacheService: Provider;\n  cacheName?: string;\n  cacheMechanism?: CacheMechanismType;\n  cookieExpiry?: number;\n}\n\nconst DEFAULT_CACHE_NAME = 'lang';\nconst DEFAULT_CACHE_MECHANISM = CacheMechanism.LocalStorage;\nconst DEFAULT_COOKIE_EXPIRY = 720;\n\n@Injectable()\nexport class TranslateCacheSettings {\n  constructor(@Inject(CACHE_NAME) public cacheName: string = DEFAULT_CACHE_NAME,\n              @Inject(CACHE_MECHANISM) public cacheMechanism: string = DEFAULT_CACHE_MECHANISM,\n              @Inject(COOKIE_EXPIRY) public cookieExpiry: number = DEFAULT_COOKIE_EXPIRY) {}\n}\n\n/* Not injectable */\nexport class TranslateCacheService {\n  constructor(private translateService: TranslateService,\n              private translateCacheSettings: TranslateCacheSettings) {}\n\n  public init(): void {\n    this.translateService.onLangChange\n      .subscribe((event: TranslationChangeEvent) => {\n        if (this.translateCacheSettings.cacheMechanism === CacheMechanism.LocalStorage) {\n          return this.cacheWithLocalStorage(event.lang);\n        }\n\n        if (this.translateCacheSettings.cacheMechanism === CacheMechanism.Cookie) {\n          return this.cacheWithCookies(event.lang);\n        }\n      });\n\n    const currentLang = this.getCachedLanguage() || this.translateService.getBrowserLang();\n\n    if (currentLang) { this.translateService.use(currentLang); }\n  }\n\n  public getCachedLanguage(): string {\n    if (this.translateCacheSettings.cacheMechanism === CacheMechanism.LocalStorage) {\n      return this.cacheWithLocalStorage();\n    }\n\n    if (this.translateCacheSettings.cacheMechanism === CacheMechanism.Cookie) {\n      return this.cacheWithCookies();\n    }\n  }\n\n  private cacheWithLocalStorage(value?: string): string {\n    if (typeof window === 'undefined' || typeof window.localStorage === 'undefined') { return; }\n\n    try {\n      if (value) { window.localStorage.setItem(this.translateCacheSettings.cacheName, value); return; }\n\n      return window.localStorage.getItem(this.translateCacheSettings.cacheName);\n    } catch (e) { return; }\n  }\n\n  private cacheWithCookies(value?: string): string {\n    if (typeof document === 'undefined' || typeof document.cookie === 'undefined') { return; }\n\n    try {\n      const name = encodeURIComponent(this.translateCacheSettings.cacheName);\n\n      if (value) {\n        const date: Date = new Date();\n\n        date.setTime(date.getTime() + this.translateCacheSettings.cookieExpiry * 3600000);\n        document.cookie = `${name}=${encodeURIComponent(value)};expires=${date.toUTCString()}`;\n\n        return;\n      }\n      const regexp = new RegExp('(?:^' + name + '|;\\\\s*' + name + ')=(.*?)(?:;|$)', 'g');\n      const result = regexp.exec(document.cookie);\n\n      return decodeURIComponent(result[1]);\n    } catch (e) { return; }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { TranslateCacheConfig, CACHE_NAME, CACHE_MECHANISM, COOKIE_EXPIRY,\n  TranslateCacheSettings } from './ngx-translate-cache.service';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [],\n  exports: []\n})\nexport class TranslateCacheModule {\n  static forRoot(config: TranslateCacheConfig): ModuleWithProviders<TranslateCacheModule> {\n    return {\n      ngModule: TranslateCacheModule,\n      providers: [\n        { provide: CACHE_NAME, useValue: config.cacheName },\n        { provide: CACHE_MECHANISM, useValue: config.cacheMechanism },\n        { provide: COOKIE_EXPIRY, useValue: config.cookieExpiry },\n        TranslateCacheSettings,\n        config.cacheService,\n      ]\n    };\n  }\n}\n","/*\n * Public API Surface of ngx-translate-cache\n */\n\nexport * from './lib/ngx-translate-cache.service';\nexport * from './lib/ngx-translate-cache.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}